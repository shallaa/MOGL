<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>MoGL Test Suite - drawTriangle By ParserShader</title>
    <script src="../src/MoGL.js"></script>
    <script src="../src/Vertex.js"></script>
    <script src="../src/VertexShaderFunctions.js"></script>
    <script src="../src/Matrix.js"></script>
    <script src="../src/Geometry.js"></script>
    <script src="../src/Material.js"></script>
    <script src="../src/Texture.js"></script>
    <script src="../src/Mesh.js"></script>
    <script src="../src/Group.js"></script>
    <script src="../src/Camera.js"></script>
    <script src="../src/Scene.js"></script>
    <script src="../src/World.js"></script>
</head>
<body>
<canvas id="firstTest" width="600" height="400"></canvas>

<script>
    // 모글에 전역적인 루프 시스템이 있것고..
    var renders = []
    var LOOP = {}
    setInterval(function () {
        for (var i = 0; i < renders.length; i++) renders[i]._render()
        for (var k in LOOP) {
            LOOP[k]()
        }
    }, 16)

    var baseVertexShader = {
        attributes: ['vec3 aVertexPosition'],
        uniforms: ['vec3 uRotate', 'vec3 uScale', 'vec3 uPosition'],
        varyings: [],
        function: [VertexShader.baseFunction],
        main: ['gl_Position = positionMTX(uPosition)*rotationMTX(uRotate)*scaleMTX(uScale)*vec4(aVertexPosition, 1.0)']
    }
    var baseFragmentShader = {
        precision: 'mediump float',
        uniforms: [],
        varyings: [],
        function: [],
        main: ['gl_FragColor =  vec4(1.0,1.0,1.0, 1.0)']
    }


    var w = new World('firstTest');
    w.addScene('s0', new Scene());

    w.getScene('s0').addVertexShader('base', baseVertexShader);
    w.getScene('s0').addFragmentShader('base', baseFragmentShader);

    w.getScene('s0').addGeometry('tri', new Geometry([-1, 0, 0, 1, 0, 0, 0, 1, 0], [0, 1, 2]));
    w.getScene('s0').addMaterial('white', new Material('#fff'));
    w.getScene('s0').addChild('tri', new Mesh('tri', new Material('#ff2244')));
    w.getScene('s0').addChild('camera1', new Camera());
    w.getScene('s0')._update = 1
    //    w.getScene('s0').addChild('camera2', new Camera());
    w.addRender('s0', 'camera1');
    //    w.addRender('s0', 'camera2');
    //
    LOOP['test '] = function () {
        w.getScene('s0').getChild('tri').rotateX += 0.01
        w.getScene('s0').getChild('tri').rotateY += 0.01
        w.getScene('s0').getChild('tri').rotateZ += 0.01
        w.getScene('s0').getChild('tri').scaleX = w.getScene('s0').getChild('tri').scaleY = w.getScene('s0').getChild('tri').scaleZ = Math.sin(w.getScene('s0').getChild('tri').rotateZ) / 2 + 0.5
        w.getScene('s0').getChild('tri').x = Math.sin(w.getScene('s0').getChild('tri').rotateZ) / 2
        w.getScene('s0').getChild('tri').y = Math.cos(w.getScene('s0').getChild('tri').rotateZ) / 2
        w.getScene('s0').getChild('camera1').setBackgroundColor('#ffdddf')
        w.getScene('s0').getChild('camera1')._r = Math.random()
        w.getScene('s0').getChild('camera1')._g = Math.random()
        w.getScene('s0').getChild('camera1')._b = Math.random()
    }

    renders.push(w)
</script>
</body>
</html>