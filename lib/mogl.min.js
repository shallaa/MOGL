var MoGL=function(){var t,e,i,r,s,n,m,o;return e={factory:1},i={superChain:1},t={isProtoChain:1},r=0,n=0,s={},m=function(){arguments[0]!==t&&(Object.defineProperty(this,"uuid",{value:r++}),Object.defineProperty(this,"isAlive",{value:!0,writable:!0}),s[this.constructor.uuid]++,n++)},o=m.prototype,o.destroy=function(){var t;for(t in this)this.hasOwnProperty(t)&&(this[t]=null);this.isAlive=!1,s[this.constructor.uuid]--,n--},Object.seal(o),m.count=function(t){return"function"==typeof t?s[t.uuid]:n},m.error=function(t,e,i){throw new Error(t+"."+e+":"+i)},m.isAlive=function(t){if(!t.isAlive)throw new Error("Destroyed Object:"+t)},m.ext=function(n,o){var a,h,l,u;o===m||"uuid"in o||m.error("MoGL","ext",0),a=function(){var r,s=arguments[0];if(s!==t)return s!==i?this instanceof a?(r=s===e?arguments[1]:arguments,o.call(this,i,r),n.apply(this,r),Object.seal(this),this):a.call(Object.create(a.prototype),e,arguments):(o.apply(this,arguments[1]),void n.apply(this,arguments[1]))},Object.defineProperty(a,"uuid",{value:r++}),a.uuid in s||(s[a.uuid]=0),l=new o(t),h=n.prototype;for(u in h)h.hasOwnProperty(u)&&(l[u]=h[u]);return l.constructor=a,a.prototype=l,Object.freeze(a),Object.seal(l),a},Object.seal(m),m}(),Vertex={x:"x",y:"y",z:"z",r:"r",g:"g",b:"b",a:"a",normalX:"nx",normalY:"ny",normalZ:"nz",u:"u",v:"v"},Matrix=function(){if(window.WebkitCSSMatrix)return window.WebkitCSSMatrix;if(window.MSCSSMatrix)return window.MSCSSMatrix;var t=function(t){if(!t||"none"===t){for(var e=0;16>e;e++)this["m"+((e/4|0)+1)+(e%4+1)]=e%4==(e/4|0)?1:0;return this}return this.setMatrixValue(t)};return t.prototype={constructor:t,PID180:Math.PI/180,get a(){return this.m11},get b(){return this.m21},get c(){return this.m12},get d(){return this.m22},get e(){return this.m13},get f(){return this.m23},set a(t){this.m11=t},set b(t){this.m21=t},set c(t){this.m12=t},set d(t){this.m22=t},set e(t){this.m13=t},set f(t){this.m23=t},inverse:function(){var t=this.__clone__();return t.m11=t.m23*t.m34*t.m42-t.m24*t.m33*t.m42+t.m24*t.m32*t.m43-t.m22*t.m34*t.m43-t.m23*t.m32*t.m44+t.m22*t.m33*t.m44,t.m12=t.m14*t.m33*t.m42-t.m13*t.m34*t.m42-t.m14*t.m32*t.m43+t.m12*t.m34*t.m43+t.m13*t.m32*t.m44-t.m12*t.m33*t.m44,t.m13=t.m13*t.m24*t.m42-t.m14*t.m23*t.m42+t.m14*t.m22*t.m43-t.m12*t.m24*t.m43-t.m13*t.m22*t.m44+t.m12*t.m23*t.m44,t.m14=t.m14*t.m23*t.m32-t.m13*t.m24*t.m32-t.m14*t.m22*t.m33+t.m12*t.m24*t.m33+t.m13*t.m22*t.m34-t.m12*t.m23*t.m34,t.m21=t.m24*t.m33*t.m41-t.m23*t.m34*t.m41-t.m24*t.m31*t.m43+t.m21*t.m34*t.m43+t.m23*t.m31*t.m44-t.m21*t.m33*t.m44,t.m22=t.m13*t.m34*t.m41-t.m14*t.m33*t.m41+t.m14*t.m31*t.m43-t.m11*t.m34*t.m43-t.m13*t.m31*t.m44+t.m11*t.m33*t.m44,t.m23=t.m14*t.m23*t.m41-t.m13*t.m24*t.m41-t.m14*t.m21*t.m43+t.m11*t.m24*t.m43+t.m13*t.m21*t.m44-t.m11*t.m23*t.m44,t.m24=t.m13*t.m24*t.m31-t.m14*t.m23*t.m31+t.m14*t.m21*t.m33-t.m11*t.m24*t.m33-t.m13*t.m21*t.m34+t.m11*t.m23*t.m34,t.m31=t.m22*t.m34*t.m41-t.m24*t.m32*t.m41+t.m24*t.m31*t.m42-t.m21*t.m34*t.m42-t.m22*t.m31*t.m44+t.m21*t.m32*t.m44,t.m32=t.m14*t.m32*t.m41-t.m12*t.m34*t.m41-t.m14*t.m31*t.m42+t.m11*t.m34*t.m42+t.m12*t.m31*t.m44-t.m11*t.m32*t.m44,t.m33=t.m12*t.m24*t.m41-t.m14*t.m22*t.m41+t.m14*t.m21*t.m42-t.m11*t.m24*t.m42-t.m12*t.m21*t.m44+t.m11*t.m22*t.m44,t.m34=t.m14*t.m22*t.m31-t.m12*t.m24*t.m31-t.m14*t.m21*t.m32+t.m11*t.m24*t.m32+t.m12*t.m21*t.m34-t.m11*t.m22*t.m34,t.m41=t.m23*t.m32*t.m41-t.m22*t.m33*t.m41-t.m23*t.m31*t.m42+t.m21*t.m33*t.m42+t.m22*t.m31*t.m43-t.m21*t.m32*t.m43,t.m42=t.m12*t.m33*t.m41-t.m13*t.m32*t.m41+t.m13*t.m31*t.m42-t.m11*t.m33*t.m42-t.m12*t.m31*t.m43+t.m11*t.m32*t.m43,t.m43=t.m13*t.m22*t.m41-t.m12*t.m23*t.m41-t.m13*t.m21*t.m42+t.m11*t.m23*t.m42+t.m12*t.m21*t.m43-t.m11*t.m22*t.m43,t.m44=t.m12*t.m23*t.m31-t.m13*t.m22*t.m31+t.m13*t.m21*t.m32-t.m11*t.m23*t.m32-t.m12*t.m21*t.m33+t.m11*t.m22*t.m33,t.scale(1/t.__determinant__())},multiply:function(t){return this.__multiplyMatrices__(this.__clone__(),t)},__multiplyMatrices__:function(t,e){return e.m11=e.m11*t.m11+e.m12*t.m21+e.m13*t.m31+e.m14*t.m41,e.m12=e.m11*t.m12+e.m12*t.m22+e.m13*t.m32+e.m14*t.m42,e.m13=e.m11*t.m13+e.m12*t.m23+e.m13*t.m33+e.m14*t.m43,e.m14=e.m11*t.m14+e.m12*t.m24+e.m13*t.m34+e.m14*t.m44,e.m21=e.m21*t.m11+e.m22*t.m21+e.m23*t.m31+e.m24*t.m41,e.m22=e.m21*t.m12+e.m22*t.m22+e.m23*t.m32+e.m24*t.m42,e.m23=e.m21*t.m13+e.m22*t.m23+e.m23*t.m33+e.m24*t.m43,e.m24=e.m21*t.m14+e.m22*t.m24+e.m23*t.m34+e.m24*t.m44,e.m31=e.m31*t.m11+e.m32*t.m21+e.m33*t.m31+e.m34*t.m41,e.m32=e.m31*t.m12+e.m32*t.m22+e.m33*t.m32+e.m34*t.m42,e.m33=e.m31*t.m13+e.m32*t.m23+e.m33*t.m33+e.m34*t.m43,e.m34=e.m31*t.m14+e.m32*t.m24+e.m33*t.m34+e.m34*t.m44,e.m41=e.m41*t.m11+e.m42*t.m21+e.m43*t.m31+e.m44*t.m41,e.m42=e.m41*t.m12+e.m42*t.m22+e.m43*t.m32+e.m44*t.m42,e.m43=e.m41*t.m13+e.m42*t.m23+e.m43*t.m33+e.m44*t.m43,e.m44=e.m41*t.m14+e.m42*t.m24+e.m43*t.m34+e.m44*t.m44,e},multiplyLeft:function(t){return this.__multiplyMatrices__(t,this.__clone__())},rotate:function(t,e,i){return!t||e&&i?!e||t&&i?!i||t&&e?(e=e||t,i=i||i,this.__rotateX__(t).__rotateY__(e).__rotateZ__(i)):this.__rotateZ__(i):this.__rotateY__(e):this.__rotateX__(t)},__rotateX__:function(t){var e=Math.cos(-t*Math.PI/180),i=Math.sin(-t*Math.PI/180),r=this.__clone__();return r.m12=e*this.m12+i*this.m13,r.m22=e*this.m22+i*this.m23,r.m32=e*this.m32+i*this.m33,r.m42=e*this.m42+i*this.m43,r.m13=e*this.m13-i*this.m12,r.m23=e*this.m23-i*this.m22,r.m33=e*this.m33-i*this.m32,r.m43=e*this.m43-i*this.m42,r},__rotateY__:function(t){var e=Math.cos(-t*this.PID180),i=Math.sin(-t*this.PID180),r=this.__clone__();return r.m11=e*this.m11-i*this.m13,r.m21=e*this.m21-i*this.m23,r.m31=e*this.m31-i*this.m33,r.m41=e*this.m41-i*this.m43,r.m13=e*this.m13+i*this.m11,r.m23=e*this.m23+i*this.m21,r.m33=e*this.m33+i*this.m31,r.m43=e*this.m43+i*this.m41,r},__rotateZ__:function(t){var e=Math.cos(-t*this.PID180),i=Math.sin(-t*this.PID180),r=this.__clone__();return r.m11=e*this.m11+i*this.m12,r.m21=e*this.m21+i*this.m22,r.m31=e*this.m31+i*this.m32,r.m41=e*this.m41+i*this.m42,r.m12=e*this.m12-i*this.m11,r.m22=e*this.m22-i*this.m21,r.m32=e*this.m32-i*this.m31,r.m42=e*this.m42-i*this.m41,r},rotateAxisAngle:function(e,i,r,s){if(i=i||e,r=r||i,1===e&&0===i&&0===r)return this.__rotateX__(s);if(0===e&&1===i&&0===r)return this.__rotateY__(s);if(0===e&&0===i&&1===r)return this.__rotateZ__(s);var n=new t,m=Math.cos(s)*this.PID180,o=Math.sin(s)*this.PID180;return n.m11=m+e*e*(1-m),n.m12=e*i*(1-m)-r*o,n.m13=e*r*(1-m)+i*o,n.m21=i*e*(1-m)+r*o,n.m22=m+i*i*(1-m),n.m23=i*r*(1-m)-e*o,n.m31=r*e*(1-m)-i*o,n.m32=r*i*(1-m)+e*o,n.m33=m+r*r*(1-m),this.__clone__().multiply(n)},scale:function(t,e,i){e=e||t,i=i||1;var r=this.__clone__();return r.m11*=t,r.m21*=e,r.m31*=i,r.m12*=t,r.m22*=e,r.m32*=i,r.m13*=t,r.m23*=e,r.m33*=i,r.m13*=t,r.m24*=e,r.m34*=i,r},setMatrixValue:function(t){for(var e=t.match(/[+-]?\d*[.]?\d+(?=,|\))/g),i=0;16>i;i++)this["m"+((i/4|0)+1)+(i%4+1)]=Number(e[i]);return this},skewX:function(t){t*=this.PID180;var e=this.__clone__();return e.m21=Math.tan(t),e},skewY:function(t){t*=this.PID180;var e=this.__clone__();return e.m12=Math.tan(t),e},toString:function(){for(var t=this.m11.toFixed(6),e=1;16>e;e++)t+=","+this["m"+((e/4|0)+1)+(e%4+1)].toFixed(6);return"matrix3d("+t+")"},translate:function(t,e,i){var r=this.__clone__(),i=i||0;return r.m41=r.m11*t+r.m21*e+r.m31*i+r.m41,r.m42=r.m12*t+r.m22*e+r.m32*i+r.m42,r.m43=r.m13*t+r.m14*e+r.m33*i+r.m43,r.m44=r.m14*t+r.m24*e+r.m34*i+r.m44,r},__determinant__:function(){return this.m41*(+this.m14*this.m23*this.m32-this.m13*this.m24*this.m32-this.m14*this.m22*this.m33+this.m12*this.m24*this.m33+this.m13*this.m22*this.m34-this.m12*this.m23*this.m34)+this.m42*(+this.m11*this.m23*this.m34-this.m11*this.m24*this.m33+this.m14*this.m21*this.m33-this.m13*this.m21*this.m34+this.m13*this.m24*this.m31-this.m14*this.m23*this.m31)+this.m43*(+this.m11*this.m24*this.m32-this.m11*this.m22*this.m34-this.m14*this.m21*this.m32+this.m12*this.m21*this.m34+this.m14*this.m22*this.m31-this.m12*this.m24*this.m31)+this.m44*(-this.m13*this.m22*this.m31-this.m11*this.m23*this.m32+this.m11*this.m22*this.m33+this.m13*this.m21*this.m32-this.m12*this.m21*this.m33+this.m12*this.m23*this.m31)},__clone__:function(){for(var e=new t,i=0;16>i;i++)e["m"+((i/4|0)+1)+(i%4+1)]=this["m"+((i/4|0)+1)+(i%4+1)];return e}},t}(),Geometry=function(){var t,e;return t=function(t,e,i){var r,s,n,m,o=t instanceof Float32Array,a=e instanceof Uint16Array;if(Array.isArray(t)||o||MoGL.error("Geometry","constructor",0),Array.isArray(e)||a||isUint32||MoGL.error("Geometry","constructor",1),i){for(r=i.length,t.length%r&&MoGL.error("Geometry","constructor",2);r--;)i[i[r]]=r;console.log(i)}if(n=arguments[2]?arguments[2].length:3,this._vertexCount=t.length/n,this._triangleCount=e.length/3,this._vertexShaders={},this._position=[],this._normal=[],this._uv=[],this._name=null,this._color=[],arguments[2]){for(r=0,s=t.length/n;s>r;r++)m=n*r,this._position.push(t[m+i.x],t[m+i.y],t[m+i.z]),i.nx?this._normal.push(t[m+i.nx],t[m+i.ny],t[m+i.nz]):0,i.u?this._uv.push(t[m+i.u],t[m+i.v]):0,i.r?this._color.push(t[m+i.r],t[m+i.g],t[m+i.b],t[m+i.a]):0;this._position=new Float32Array(this._position),this._normal=new Float32Array(this._normal),this._uv=new Float32Array(this._uv),this._color=new Float32Array(this._color)}else this._position=o?t:new Float32Array(t);this._index=a?e:new Uint16Array(e)},e=t.prototype,e.addVertexShader=function(t){return MoGL.isAlive(this),this._vertexShaders[t]=t,this},e.getVertexCount=function(){return MoGL.isAlive(this),this._vertexCount},e.getTriangleCount=function(){return MoGL.isAlive(this),this._triangleCount},e.getVolume=function(){if(MoGL.isAlive(this),!("_volume"in this)){for(var t,e,i,r=0,s=0,n=0,m=0,o=0,a=0,h=this._position,l=h.length;l--;)t=3*l,e=t+1,i=t+2,r=h[t]<r?h[t]:r,m=h[t]>m?h[t]:m,s=h[e]<s?h[e]:s,o=h[e]>o?h[e]:o,n=h[i]<n?h[i]:n,a=h[i]>a?h[i]:a;this._volume=[m-r,o-s,a-n]}return this._volume},e.removeVertexShader=function(t){return MoGL.isAlive(this),delete this._vertexShaders[t],this},MoGL.ext(t,MoGL)}(),Material=function(){var t,e,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,r=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i;return t=function(){var t,e,s=arguments[0];this._textures={__indexList:[]},this._r=1,this._g=1,this._b=1,this._a=1,this._count=0,this._scene=null,1==arguments.length?(s.length>7&&(e=+s.substr(7),s=s.substr(0,7)),"#"==s.charAt(0)&&((t=i.exec(s))?(this._r=parseInt(t[1],16)/255,this._g=parseInt(t[2],16)/255,this._b=parseInt(t[3],16)/255):(t=r.exec(s),this._r=parseInt(t[1]+t[1],16)/255,this._g=parseInt(t[2]+t[2],16)/255,this._b=parseInt(t[3]+t[3],16)/255),this._a=e?e>1?1:e:1)):(this._r=arguments[0],this._g=arguments[1],this._b=arguments[2],this._a=arguments[3]?arguments[3]:1)},e=t.prototype,e.addTexture=function(t){var e=this._scene;e&&!e._textures[t]&&MoGL.error("Material","addTexture",0),this._textures[t]&&MoGL.error("Material","addTexture",1),this._textures[t]=t;var i;return i=arguments[1]?this._textures.__indexList.splice(arguments[1],0,{id:t,blendMode:arguments[2]}):this._textures.__indexList.push({id:t,blendMode:arguments[2]}),this},e.getRefCount=function(){return this._count},e.removeTexture=function(t){for(var e=this._textures.__indexList.length;e--;)if(this._textures.__indexList[e].id==t){this._textures.__indexList.splice(e,1);break}return delete this._textures[t],this},MoGL.ext(t,MoGL)}(),Texture={zoomOut:"zoomOut",zoomIn:"zoomIn",crop:"crop",addSpace:"addSpace"},Mesh=function(){var t,e,i=new Float32Array(3),r=Math.sqrt,s=Math.atan2,n=Math.asin,m=Math.cos,o=.5*Math.PI,a=180/Math.PI;return t=function(t,e){t&&!("string"==typeof t||t instanceof Geometry)&&MoGL.error("Mesh","contructor",0),e&&!("string"==typeof e||e instanceof Material)&&MoGL.error("Mesh","contructor",1),this._geometry=t,this._material=e,this._scene=null,this._parent=null,this._matrix=new Matrix,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.x=0,this.y=0,this.z=0},e=t.prototype,e.getGeometry=function(){return MoGL.isAlive(this),this._scene?this._geometry:null},e.getMaterial=function(){return MoGL.isAlive(this),this._scene?this._material:null},e.getMatrix=function(){MoGL.isAlive(this),this._matrix=new Matrix;var t=this._matrix.scale(this.scaleX,this.scaleY,this.scaleZ),e=this._matrix.rotate(this.rotateX,this.rotateY,this.rotateZ),i=this._matrix.translate(this.x,this.y,this.z);return this._matrix=i.multiply(e).multiply(t)},e.getParent=function(){return MoGL.isAlive(this),this._scene?this._scene:null},e.getPosition=function(){return MoGL.isAlive(this),i[0]=this.x,i[1]=this.y,i[2]=this.z,i},e.getRotate=function(){return MoGL.isAlive(this),i[0]=this.rotateX,i[1]=this.rotateY,i[2]=this.rotateZ,i},e.getScale=function(){return MoGL.isAlive(this),i[0]=this.scaleX,i[1]=this.scaleY,i[2]=this.scaleZ,i},e.setGeometry=function(t){return MoGL.isAlive(this),t instanceof Geometry||"string"==typeof t||MoGL.error("Mesh","setGeometry",0),this._scene?(this._geometry=(this._geometry="string"==typeof t)?this._scene._geometrys[t]:t,this._geometry._name=t):this._geometry=t,this},e.setMaterial=function(t){return MoGL.isAlive(this),t instanceof Material||"string"==typeof t||MoGL.error("Mesh","setMaterial",0),this._scene?(this._material=(this._material="string"==typeof t)?this._scene._materials[t]:t,this._material._name=t):this._material=t,this},e.setMatrix=function(t){MoGL.isAlive(this);var e,i,h,l,u,_,c=t;if(c){c instanceof Matrix&&(c=[t.m11,t.m12,t.m13,t.m14,t.m21,t.m22,t.m23,t.m24,t.m31,t.m32,t.m33,t.m34,t.m41,t.m42,t.m43,t.m44]),this.x=c[12],this.y=c[13],this.z=c[14];var f=c[0],g=c[4],d=c[8],v=c[1],M=c[5],p=c[9],x=c[2],A=c[6],L=c[10];l=r(f*f+v*v+x*x),u=r(g*g+M*M+A*A),_=r(d*d+p*p+L*L),this.scaleX=l,this.scaleY=u,this.scaleZ=_,l>0&&(f/=l,v/=l,x/=l);var y=-x;i=-1>=y?-o:y>=1?o:n(y);var G=m(i);.001>=G?(h=0,e=s(-p,M)):(h=s(v,f),e=s(A,L)),this.rotateX=e*a,this.rotateY=i*a,this.rotateZ=h*a}else this.x=0,this.y=0,this.z=0,this.rotateX=0,this.rotateY=0,this.rotateZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1;return this},e.setPosition=function(){return MoGL.isAlive(this),this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this},e.setRotate=function(){return MoGL.isAlive(this),this.rotateX=arguments[0],this.rotateY=arguments[1],this.rotateZ=arguments[2],this},e.setScale=function(){return MoGL.isAlive(this),this.scaleX=arguments[0],this.scaleY=arguments[1],this.scaleZ=arguments[2],this},MoGL.ext(t,MoGL)}(),Group=function(){var t,e;return t=function(){this._children={},this._scene=null},e=t.prototype,e.addChild=function(t,e){var i,r;this._children[t]&&MoGL.error("Group","addChild",0),e instanceof Mesh||MoGL.error("Group","addChild",1),e._scene=this,e.setGeometry(e._geometry),e.setMaterial(e._material),r=e._geometry._vertexShaders;for(i in r)"string"==typeof r[i]&&(this._scene._vertexShaders[r[i]]||MoGL.error("Group","addChild",2));r=e._material._fragmentShaders;for(i in r)"string"==typeof r[i]&&(this._scene._fragmentShaders[r[i]]||MoGL.error("Group","addChild",3));r=e._material._textures;for(i in r)"string"==typeof r[i]&&(this._scene._textures[r[i]]||MoGL.error("Group","addChild",4));return this._children[t]=e,this},e.getChild=function(t){var e=this._children[t];return e?e:null},e.removeChild=function(t){return this._children[t]?(delete this._children[t],!0):!1},MoGL.ext(t,Mesh)}(),Camera=function(){var t,e,i=[],r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,s=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i;return t=function(){this._cvs=null,this._geometry=new Geometry([],[]),this._material=new Material,this._r=0,this._g=0,this._b=0,this._a=1,this._fov=55,this._near=.1,this._far=1e5,this._renderArea=null,this._visible=1,this._filters={},this._fog=null,this._antialias=!1,this._pixelMatrix=Matrix()},e=t.prototype,e.getBackgroundColor=function(){return MoGL.isAlive(this),i[0]=this._r,i[1]=this._g,i[2]=this._b,i[3]=this._a,i},e.getClipPlane=function(){return MoGL.isAlive(this),[this._near,this._far]},e.getFilters=function(){MoGL.isAlive(this);var t=[],e=this._filters;for(var i in e)t.push(i);return t},e.getFog=function(){return MoGL.isAlive(this),this._fog?!0:!1},e.getFOV=function(){return MoGL.isAlive(this),this._fov},e.getProjectionMatrix=function(){MoGL.isAlive(this);var t=this._renderArea[2]/this._renderArea[3],e=1/Math.tan(this._fov*Math.PI/180/2),i=e/t;return this._pixelMatrix=[i,0,0,0,0,-e,0,0,0,0,this._far/(this._far-this._near),1,0,0,this._near*this._far/(this._near-this._far),1],this._pixelMatrix},e.getRenderArea=function(){return MoGL.isAlive(this),this._renderArea},e.getAntialias=function(){return MoGL.isAlive(this),this._antialias?!0:!1},e.getVisible=function(){return MoGL.isAlive(this),this._visible?!0:!1},e.setBackgroundColor=function(){MoGL.isAlive(this);var t,e,i=arguments[0];return 1==arguments.length?(i.length>7&&(e=+i.substr(7),i=i.substr(0,7)),"#"==i.charAt(0)&&((t=r.exec(i))?(this._r=parseInt(t[1],16)/255,this._g=parseInt(t[2],16)/255,this._b=parseInt(t[3],16)/255):(t=s.exec(i),this._r=parseInt(t[1]+t[1],16)/255,this._g=parseInt(t[2]+t[2],16)/255,this._b=parseInt(t[3]+t[3],16)/255),this._a=e?e>1?1:e:1)):(this._r=arguments[0],this._g=arguments[1],this._b=arguments[2],this._a=arguments[3]?arguments[3]:1),this},e.setClipPlane=function(t,e){return MoGL.isAlive(this),this._near=t,this._far=e,this},e.setFilter=function(t){MoGL.isAlive(this);var e;if(arguments[1])e=arguments[1];else switch(t){case Filter.anaglyph:e={offsetL:.008,offsetR:.008,gIntensity:.7,bIntensity:.7};break;case Filter.bevel:e={distance:4,angle:45,highlightColor:"#FFF",highlightAlpha:1,shadowColor:"#000",shadowAlpha:1,blurX:4,blurY:4,strength:1,quality:1,type:"inner",knockout:!1};break;case Filter.bloom:e={threshold:.3,sourceSaturation:1,bloomSaturation:1.3,sourceIntensity:1,bloomIntensity:1};break;case Filter.blur:e={blurX:4,blurY:4,quality:1};break;case Filter.colorMatrix:e={};break;case Filter.convolution:e={matrixX:0,matrixY:0,matrix:null,divisor:1,bias:0,preserveAlpha:!0,clamp:!0,color:0,alpha:0};break;case Filter.displacementMap:e={mapTextureID:null,mapPoint:null,componentX:0,componentY:0,scaleX:0,scaleY:0,mode:"wrap",color:0,alpha:0};break;case Filter.fxaa:e={};break;case Filter.glow:e={color:"#F00",alpha:1,blurX:6,blurY:6,strength:2,quality:1,inner:!1,knockout:!1};break;case Filter.invert:e={};break;case Filter.mono:e={};break;case Filter.sepia:e={};break;case Filter.shadow:e={distance:4,angle:45,color:0,alpha:1,blurX:4,blurY:4,strength:1,quality:1,inner:!1,knockout:!1,hideObject:!1}}return this._filters[t]=e,this},e.setFog=function(t,e,i){MoGL.isAlive(this);var n,m,o=t;return"#"==o.charAt(0)?(m={},(n=r.exec(o))?(m.r=parseInt(n[1],16)/255,m.g=parseInt(n[2],16)/255,m.b=parseInt(n[3],16)/255):(n=s.exec(o),m.r=parseInt(n[1]+n[1],16)/255,m.g=parseInt(n[2]+n[2],16)/255,m.b=parseInt(n[3]+n[3],16)/255),m.a=1,m.near=e,m.far=i,this._fog=m):t||(this._fog=null),this},e.setFOV=function(){return MoGL.isAlive(this),this._fov=1==arguments.length?arguments[0]:Math.ceil(2*Math.atan(Math.tan(arguments[2]*(Math.PI/180)/2)*(arguments[1]/arguments[0]))*(180/Math.PI)),this},e.setOthogonal=function(){return MoGL.isAlive(this),this},e.setPerspective=function(){return MoGL.isAlive(this),this},e.setProjectionMatrix=function(){return MoGL.isAlive(this),this},e.setRenderArea=function(t,e,i,r){MoGL.isAlive(this);var s=this._cvs.clientWidth,n=this._cvs.clientHeight;return console.log("string"==typeof t?s*t.replace("%",""):t),this._renderArea=["string"==typeof t?s*t.replace("%","")*.01:t,"string"==typeof e?n*e.replace("%","")*.01:e,"string"==typeof i?s*i.replace("%","")*.01:i,"string"==typeof r?n*r.replace("%","")*.01:r],this},e.setAntialias=function(t){return MoGL.isAlive(this),this._antialias=t,this},e.setVisible=function(t){return MoGL.isAlive(this),this._visible=t,this},e.removeFilter=function(t){return MoGL.isAlive(this),delete this._filters[t],this},MoGL.ext(t,Mesh)}(),Scene=function(){var t,e;t=function(){this._update=0,this._cvs=null,this._children={},this._cameras={},this._textures={},this._materials={},this._geometrys={},this._vertexShaders={},this._fragmentShaders={},this._gl=null,this._glVBOs={},this._glUVBOs={},this._glIBOs={},this._glPROGRAMs={},this._glTEXTUREs={}};var i=function(t,e,i,r){var s=t._gl,n=t._glVBOs[e];return n?n:(n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,new Float32Array(i),s.STATIC_DRAW),n.name=e,n.type="VBO",n.data=i,n.stride=r,n.numItem=i.length/r,t._glVBOs[e]=n,console.log("VBO생성",t._glVBOs[e]),t._glVBOs[e])},r=function(t,e,i,r){var s=t._gl,n=t._glIBOs[e];return n?n:(n=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),s.STATIC_DRAW),n.name=e,n.type="IBO",n.data=i,n.stride=r,n.numItem=i.length/r,t._glIBOs[e]=n,console.log("IBO생성",t._glIBOs[e]),t._glIBOs[e])},s=function(t,e,i,r){var s=t._gl,n=t._glUVBOs[e];return n?n:(n=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,n),s.bufferData(s.ARRAY_BUFFER,new Float32Array(i),s.STATIC_DRAW),n.name=e,n.type="UVBO",n.data=i,n.stride=r,n.numItem=i.length/r,t._glUVBOs[e]=n,console.log("UVBO생성",t._glUVBOs[e]),t._glUVBOs[e])},n=function(t,e){var i,r,s,n,a=t._gl;for(i=m(t,t._vertexShaders[e]),r=o(t,t._fragmentShaders[e]),s=a.createProgram(),a.attachShader(s,i),a.attachShader(s,r),a.linkProgram(s),i.name=e+"_vertex",r.name=e+"_fragment",s.name=e,a.getProgramParameter(s,a.LINK_STATUS)||MoGL.error(e," 프로그램 쉐이더 초기화 실패!",0),a.useProgram(s),n=0;n<i.attributes.length;n++)a.bindBuffer(a.ARRAY_BUFFER,t._glVBOs["null"]),a.enableVertexAttribArray(s[i.attributes[n]]=a.getAttribLocation(s,i.attributes[n])),a.vertexAttribPointer(s[i.attributes[n]],t._glVBOs["null"].stride,a.FLOAT,!1,0,0);for(n=0;n<i.uniforms.length;n++)s[i.uniforms[n]]=a.getUniformLocation(s,i.uniforms[n]);return t._glPROGRAMs[e]=s,console.log(i),console.log(r),console.log(s),s},m=function(t,e){var i,r,s,n,m=t._gl,o=m.createShader(m.VERTEX_SHADER);for(o.uniforms=[],o.attributes=[],n="",i=e.attributes,r=i.length,s=0;r>s;s++)n+="attribute "+i[s]+";\n",o.attributes.push(i[s].split(" ")[1]);for(i=e.uniforms,r=i.length,s=0;r>s;s++)n+="uniform "+i[s]+";\n",o.uniforms.push(i[s].split(" ")[1]);for(i=e.varyings,r=i.length,s=0;r>s;s++)n+="varying "+i[s]+";\n";return n+=VertexShader.baseFunction,n+="void main(void){\n",n+=e.main+";\n",n+="}\n",console.log(n),m.shaderSource(o,n),m.compileShader(o),o},o=function(t,e){var i,r,s,n=t._gl,m="",o=n.createShader(n.FRAGMENT_SHADER);for(o.uniforms=[],m+=e.precision?"precision "+e.precision+";\n":"precision mediump float;\n",r=e.uniforms,s=r.length,i=0;s>i;i++)m+="uniform "+r[i]+";\n",o.uniforms.push(r[i].split(" ")[1]);for(r=e.varyings,s=r.length,i=0;s>i;i++)m+="varying "+r[i]+";\n";return m+="void main(void){\n",m+=e.main+";\n",m+="}\n",n.shaderSource(o,m),n.compileShader(o),o.uniforms=e.uniforms,o},a=function(t,e,i){var r=t._gl,s=t._glTEXTUREs[e];return s?s:(s=r.createTexture(),s.img=new Image,"string"==typeof i?s.img.src=i:i instanceof HTMLImageElement&&(s.img.src=i.src),s.img.onload=function(){r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,s.img),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null),s.loaded=1},t._glTEXTUREs[e]=s,s)};return e=t.prototype,e.update=function(){MoGL.isAlive(this),this._glVBOs["null"]=i(this,"null",new Float32Array([0,0,0]),3);for(var t in this._children){var e=this._children[t];!this._glVBOs[e._geometry]&&e._geometry&&(this._glVBOs[e._geometry._name]=i(this,e._geometry._name,e._geometry._position,3),this._glUVBOs[e._geometry._name]=s(this,e._geometry._name,e._geometry._uv,2),this._glIBOs[e._geometry._name]=r(this,e._geometry._name,e._geometry._index,1))}for(t in this._cameras){var m=this._cameras[t];m._cvs=this._cvs,m._renderArea||m.setRenderArea(0,0,this._cvs.width,this._cvs.height)}var o=this._vertexShaders;for(t in o)n(this,t);console.log("////////////////////////////////////////////"),console.log("Scene 업데이트"),console.log("this._glVBOs :",this._glVBOs),console.log("this._glIBOs :",this._glIBOs),console.log("this._glPROGRAMs :",this._glPROGRAMs),console.log("this._geometrys :",this._geometrys),console.log("this._materials :",this._materials),console.log("this._textures :",this._textures),console.log("this._vertexShaders :",this._vertexShaders),console.log("this._fragmentShaders :",this._fragmentShaders),console.log("////////////////////////////////////////////"),this._update=0},e.addChild=function(t,e){MoGL.isAlive(this);var i,r;this._children[t]&&MoGL.error("Scene","addChild",0),e instanceof Mesh||MoGL.error("Scene","addChild",1),e._scene=this,e._parent=this,e.setGeometry(e._geometry),e.setMaterial(e._material),e._material._count++,r=e._geometry._vertexShaders;for(i in r)"string"==typeof r[i]&&(this._vertexShaders[r[i]]||MoGL.error("Scene","addChild",2));r=e._material._fragmentShaders;for(i in r)"string"==typeof r[i]&&(this._fragmentShaders[r[i]]||MoGL.error("Scene","addChild",3));r=e._material._textures;for(i in r)"string"==typeof r[i]&&(this._textures[r[i]]?(console.log(e._material._textures),console.log(r[i]),e._material._textures[r[i]]=this._textures[r[i]]):MoGL.error("Scene","addChild",4));return e instanceof Camera?(this._cameras[t]=e,e._cvs=this._cvs):this._children[t]=e,this._update=1,this},e.addGeometry=function(t,e){MoGL.isAlive(this),this._geometrys[t]&&MoGL.error("Scene","addGeometry",0),e instanceof Geometry||MoGL.error("Scene","addGeometry",1);var i,r=e._vertexShaders;for(i in r)"string"==typeof r[i]&&(this._vertexShaders[r[i]]||MoGL.error("Scene","addGeometry",2));return this._geometrys[t]=e,this},e.addMaterial=function(t,e){MoGL.isAlive(this),this._materials[t]&&MoGL.error("Scene","addMaterial",0),e instanceof Material||MoGL.error("Scene","addMaterial",1);var i,r=e._fragmentShaders;for(i in r)"string"==typeof r[i]&&(this._fragmentShaders[r[i]]||MoGL.error("Scene","addMaterial",2));r=e._textures;for(i in r)"string"==typeof r[i]&&(this._textures[r[i]]||MoGL.error("Scene","addMaterial",3));return this._materials[t]=e,this._materials[t]._scene=this,this},e.addTexture=function(t,e){function i(t){return t instanceof HTMLImageElement?0:t instanceof HTMLCanvasElement?0:t instanceof HTMLVideoElement?0:t instanceof ImageData?0:t.substring&&"data:image"==t.substring(0,10)&&t.indexOf("base64")>-1?0:"string"==typeof t?0:1}return MoGL.isAlive(this),this._textures[t]&&MoGL.error("Scene","addTexture",0),i(e)&&MoGL.error("Scene","addTexture",1),this._textures[t]?this._textures[t].img=a(this,t,e):this._textures[t]={count:0,last:0,img:a(this,t,e),resizeType:arguments[2]||null},this},e.addFragmentShader=function(t,e){return MoGL.isAlive(this),this._fragmentShaders[t]&&MoGL.error("Scene","addFragmentShader",0),this._fragmentShaders[t]=e,this},e.addVertexShader=function(t,e){return MoGL.isAlive(this),this._vertexShaders[t]&&MoGL.error("Scene","addVertexShader",0),this._vertexShaders[t]=e,this},e.getChild=function(t){MoGL.isAlive(this);var e=this._children[t];return e=e?e:this._cameras[t],e?e:null},e.getGeometry=function(t){MoGL.isAlive(this);var e=this._geometrys[t];return e?e:null},e.getMaterial=function(t){MoGL.isAlive(this);var e=this._materials[t];return e?e:null},e.getTexture=function(t){MoGL.isAlive(this);var e=this._textures[t];return e?e:null},e.getFragmentShader=function(t){return MoGL.isAlive(this),this._fragmentShaders[t]},e.getVertexShader=function(t){return MoGL.isAlive(this),this._vertexShaders[t]},e.removeChild=function(t){return MoGL.isAlive(this),this._children[t]?(this._children[t]._material._count--,this._children[t]._scene=null,this._children[t]._parent=null,delete this._children[t],!0):!1},e.removeGeometry=function(t){return MoGL.isAlive(this),this._geometrys[t]?(delete this._geometrys[t],!0):!1},e.removeMaterial=function(t){return MoGL.isAlive(this),this._materials[t]?(delete this._materials[t],!0):!1},e.removeTexture=function(t){return MoGL.isAlive(this),this._textures[t]?(delete this._textures[t],!0):!1},e.removeFragmentShader=function(){return MoGL.isAlive(this),this},e.removeVertexShader=function(){return MoGL.isAlive(this),this},MoGL.ext(t,MoGL)}(),World=function(){var t,e;return t=function(t){this._cvs=document.getElementById(t);for(var e="webgl,experimental-webgl,webkit-3d,moz-webgl".split(","),i=e.length;i--&&!(this._gl=this._cvs.getContext(e[i])););console.log(this._gl?t+" : MoGL 초기화 성공!":console.log(t+" : MoGL 초기화 실패!!"))},e=t.prototype,e._renderList=[],e._sceneList={},e._render=function(){MoGL.isAlive(this);var t,e,i,r,s,n,m,o,a,h,l,u,_,c=this._renderList;for(t=0,i=c.length;i>t;t++)if(c[t].scene._update&&c[t].scene.update(),r=c[t].scene,s=r.getChild(c[t].cameraID),s._visible){n=r._gl,m=r._children,n.viewport(s._renderArea[0],0==s._renderArea[1]?0:s._renderArea[3]-s._renderArea[1],s._renderArea[2],s._renderArea[3]),n.clearColor(s._r,s._g,s._b,s._a),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);for(e in r._glPROGRAMs)h=r._glPROGRAMs[e],n.useProgram(h),n.uniformMatrix4fv(h.uPixelMatrix,!1,s.getProjectionMatrix());o=a=h=l=_=null;for(e in m)if(o=m[e],l=r._glVBOs[o._geometry._name],u=r._glUVBOs[o._geometry._name],_=r._glIBOs[o._geometry._name],a=o._material,h=a._textures.__indexList.length>0?r._glPROGRAMs.bitmap:r._glPROGRAMs.base,n.useProgram(h),h==r._glPROGRAMs.base)n.bindBuffer(n.ARRAY_BUFFER,l),n.vertexAttribPointer(h.aVertexPosition,l.stride,n.FLOAT,!1,0,0),n.uniform3fv(h.uRotate,[o.rotateX,o.rotateY,o.rotateZ]),n.uniform3fv(h.uPosition,[o.x,o.y,o.z]),n.uniform3fv(h.uScale,[o.scaleX,o.scaleY,o.scaleZ]),n.uniform3fv(h.uColor,[a._r,a._g,a._b]),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,_),n.drawElements(n.TRIANGLES,_.numItem,n.UNSIGNED_SHORT,0);else if(h==r._glPROGRAMs.bitmap){n.bindBuffer(n.ARRAY_BUFFER,l),n.vertexAttribPointer(h.aVertexPosition,l.stride,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,u),n.vertexAttribPointer(h.aUV,u.stride,n.FLOAT,!1,0,0),n.uniform3fv(h.uRotate,[o.rotateX,o.rotateY,o.rotateZ]),n.uniform3fv(h.uPosition,[o.x,o.y,o.z]),n.uniform3fv(h.uScale,[o.scaleX,o.scaleY,o.scaleZ]),n.activeTexture(n.TEXTURE0);var f=r._glTEXTUREs[a._textures.__indexList[0].id];f.loaded&&(n.bindTexture(n.TEXTURE_2D,f),n.uniform1i(h.uSampler,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,_),n.drawElements(n.TRIANGLES,_.numItem,n.UNSIGNED_SHORT,0))}}},e.addRender=function(t,i,r){MoGL.isAlive(this);for(var s=t+"_"+i,n=e._sceneList[t],m=this._renderList,o=0,a=m.length;a>o;o++)m[o].uuid==s&&MoGL.error("World","addRender",0);n||MoGL.error("World","addRender",1),n&&(n.getChild(i)||MoGL.error("World","addRender",2));var h={uuid:s,sceneID:t,cameraID:i,scene:n,camera:n.getChild(i)};return r?m[r]=h:m.push(h),this},e.addScene=function(t,e){return MoGL.isAlive(this),this._sceneList[t]&&MoGL.error("World","addScene",0),e instanceof Scene||MoGL.error("World","addScene",1),this._sceneList[t]=e,e._gl=this._gl,e._cvs=this._cvs,this},e.getScene=function(t){return MoGL.isAlive(this),this._sceneList[t]?this._sceneList[t]:null},e.removeRender=function(t,e){MoGL.isAlive(this);var i,r,s=this._renderList;for(i=0,r=s.length;r>i;i++)s[i]&&s[i].uuid==t+"_"+e&&s.splice(i,1);return this},e.removeScene=function(t){return MoGL.isAlive(this),this._sceneList[t]?0:MoGL.error("World","addScene",0),this._sceneList[t]._gl=this._gl,delete this._sceneList[t],this},MoGL.ext(t,MoGL)}(),BlendMode={add:"add",alpha:"alpha",darken:"darken",difference:"difference",erase:"erase",hardlight:"hardlight",invert:"invert",lighten:"lighten",multiply:"multiply",screen:"screen",subtract:"subtract"},Filter={anaglyph:"anaglyph",bevel:"bevel",bloom:"bloom",blur:"blur",colorMatrix:"colorMatrix",convolution:"convolution",displacementMap:"displacementMap",fxaa:"fxaa",glow:"glow",invert:"invert",mono:"mono",sepia:"sepia",shadow:"shadow"},Light=function(){var t,e;return t=function(){},e=t.prototype,MoGL.ext(t,Mesh)}(),Primitive={cube:function(){var t;return t},geodesic:function(){var t;return t},line:function(t,e,i,r,s,n){var m;return m},plane:function(){var t;return t},point:function(){var t;return t},sphere:function(){var t;return t},skybox:function(){var t;return t}},VertexShader={
baseFunction:"mat4 positionMTX(vec3 t){\n   return mat4( 1,0,0,0, 0,1,0,0, 0,0,1,0, t[0],t[1],t[2],1);\n}\nmat4 scaleMTX(vec3 t){\n   return mat4( t[0],0,0,0, 0,t[1],0,0, 0,0,t[2],0, 0,0,0,1);\n}\nmat4 rotationMTX(vec3 t){\n   float s = sin(t[0]);float c = cos(t[0]);\n   mat4 m1 = mat4( 1,0,0,0, 0,c,-s,0, 0,s,c,0, 0,0,0,1);s = sin(t[1]);c = cos(t[1]);\n   mat4 m2 = mat4(c,0,s,0, 0,1,0,0, -s,0,c,0, 0,0,0,1);s = sin(t[2]);c = cos(t[2]);\n   mat4 m3 = mat4(c,-s,0,0, s,c,0,0, 0,0,1,0, 0,0,0,1);\n   return m3*m2*m1;\n}\n"};